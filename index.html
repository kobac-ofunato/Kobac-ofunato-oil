from pathlib import Path
import re
from textwrap import dedent
from zipfile import ZipFile
from urllib.parse import quote

# Working folder
out_dir = Path("/mnt/data/kobac-oofunato-final")
out_dir.mkdir(parents=True, exist_ok=True)
index_path = out_dir / "index.html"

# Paste the user's current HTML
current_html = """<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>新規限定！エンジンオイル交換500円キャンペーン開催中！ | 車検のコバック大船渡店</title>

  <!-- OGP -->
  <meta property="og:title" content="新規限定！エンジンオイル交換500円キャンペーン開催中！ | 車検のコバック大船渡店" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="" />
  <meta property="og:image" content="" />
  <meta property="og:site_name" content="車検のコバック大船渡店" />
  <meta property="og:description" content="大船渡店限定・新規のお客様向けエンジンオイル交換500円！作業受付時間 9:00〜17:00。お電話でお気軽にどうぞ。0120-589-196" />

  <!-- ファビコン（任意差し替え可） -->
  <link rel="apple-touch-icon-precomposed" href="images/apple-touch-icon-precomposed.png" />
  <link type="image/png" rel="shortcut icon" href="images/favicon.png" />
  <link rel="icon" href="/img/logo_boy.png"/>

  <!-- 参照サイトのCSSを流用（必要に応じてローカルに差し替え推奨） -->
  <link rel="stylesheet" href="https://sasebo.kobac-campaign-lp.com/oil/wp-content/themes/oishiimono/css/style.min.css">
  <link rel="stylesheet" href="https://sasebo.kobac-campaign-lp.com/oil/wp-content/themes/oishiimono/css/add.css">

  <!-- フォント/JS（必要最小限に絞り、計測タグは削除） -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

  <style>
    /* 追加の上書き（佐世保→大船渡向けの微調整） */
    :root { --kobac-red:#E60012; }
    .tel-only { text-align:center; margin: 12px 0 0; }
    .tel-only .tel-cta { display:inline-block; background:var(--kobac-red); color:#fff; text-decoration:none;
                         padding:12px 22px; border-radius:10px; font-weight:800; }
    /* 電話固定ボタン（SP） */
    .sticky-tel { position: fixed; left:0; right:0; bottom:0; display:block; background:var(--kobac-red);
                  color:#fff; text-align:center; padding:14px 0; font-weight:800; text-decoration:none; z-index:200; }
    @media (min-width: 768px) { .sticky-tel { display:none; } }
    /* マップは外部ボタンで開く */
    .map-btn { display:inline-block; background:var(--kobac-red); color:#fff; padding:10px 16px; border-radius:8px;
               text-decoration:none; font-weight:700; }
    /* 参照テーマ依存の余白を若干詰める */
    #campaign .campaign__time-number { font-weight: 800; }
  </style>
</head>

<body class="home blog">
  <header id="header" class="header">
    <div class="inner">
      <h1 class="logo"><a href="#">
        <picture class="mv-img">
          <source srcset="images/logo.svg" media="(min-width: 768px)"/>
          <img src="images/sp-logo.svg" alt="車検のコバック">
        </picture>
      </a></h1>
    </div>
  </header>

  <!-- メインビジュアル -->
  <section id="mv" class="mv">
    <div class="inner">
      <picture class="mv-img">
        <source srcset="images/pc-mv-img.png" media="(min-width: 768px)"/>
        <img src="images/sp-mv-img.jpg" alt="エンジンオイル交換キャンペーン">
      </picture>

      <!-- 電話のみ導線に変更 -->
      <div class="contact-nav">
        <div class="tel-only">
          <a class="tel-cta" href="tel:0120-589-196">📞 0120-589-196 に電話する</a>
        </div>
      </div>
    </div>
  </section>

  <!-- キャンペーン情報 -->
  <section id="campaign" class="campaign">
    <div class="inner">
      <div class="store02title"><span>車検のコバック 大船渡店</span></div>
      <div class="campaign__time">
        <span class="campaign__time-text">作業受付時間</span>
        <h3 class="campaign__time-number">9：00〜17：00</h3>
      </div>
    </div>
    <img src="images/triangle.svg" alt="" class="traiangle is-sp">
  </section>

  <!-- キャンペーン訴求ブロック（画像類は必要に応じて差し替え） -->
  <section id="info" class="info">
    <div class="inner">
      <picture class="info-img">
        <source srcset="images/pc-web-point.svg" media="(min-width: 768px)"/>
        <img src="images/pc-web-point.svg" alt="WEB限定ポイント">
      </picture>
    </div>
  </section>

  <section id="cp" class="cp">
    <div class="inner">
      <picture class="present-img">
        <source srcset="images/cp.png" media="(min-width: 768px)"/>
        <img src="images/cp.png" alt="キャンペーン内容">
      </picture>
    </div>
  </section>

  <section id="point03" class="point03">
    <div class="inner">
      <picture class="present-img">
        <source srcset="images/point03.png" media="(min-width: 768px)"/>
        <img src="images/point03_sp.png" alt="ポイント">
      </picture>
    </div>
  </section>

  <!-- 電話セクション（電話のみ） -->
  <section id="contact" class="contact">
    <div class="inner">
      <div class="contact-2store">
        <a href="tel:0120-589-196">
          <img src="images/conact01.svg" class="is-pc" alt="電話で問い合わせ">
          <img src="images/conact01_sp.svg" class="is-sp" alt="電話で問い合わせ">
        </a>
      </div>
    </div>
  </section>

  <section id="engine" class="engine">
    <div class="inner">
      <picture class="present-img">
        <source srcset="images/engine.png" media="(min-width: 768px)"/>
        <img src="images/engine.png" alt="エンジン豆知識">
      </picture>
    </div>
  </section>

  <section id="plus_content" class="plus_content">
    <div class="inner">
      <picture class="present-img">
        <source srcset="images/plus_content.svg" media="(min-width: 768px)"/>
        <img src="images/plus_content.svg" alt="追加情報">
      </picture>
    </div>
  </section>

  <section id="step_content" class="step_content">
    <div class="inner">
      <picture class="present-img">
        <source srcset="images/step_content.svg" media="(min-width: 768px)"/>
        <img src="images/step_content.svg" alt="ご利用の流れ">
      </picture>
    </div>
  </section>

  <!-- 再度の電話導線 -->
  <section id="contact2" class="contact">
    <div class="inner">
      <div class="contact-2store">
        <a href="tel:0120-589-196">
          <img src="images/conact01.svg" class="is-pc" alt="電話で問い合わせ">
          <img src="images/conact01_sp.svg" class="is-sp" alt="電話で問い合わせ">
        </a>
      </div>
    </div>
  </section>
</body>
</html>
"""

# 1) Insert Voice + QA sections before #shop
voice_section = """
  <section id="voice_content" class="voice_content">
    <div class="inner">
      <picture class="voiceTitle">
        <source srcset="images/voice_content.svg" media="(min-width: 768px)"/>
        <img src="images/voice_content.svg" alt="お客様の声">
      </picture>
      <ul>
        <li>
          <img src="images/voice01.svg" class="is-pc" alt="お客様の声1">
          <img src="images/voice01_sp.svg" class="is-sp" alt="お客様の声1">
        </li>
        <li>
          <img src="images/voice02.svg" class="is-pc" alt="お客様の声2">
          <img src="images/voice02_sp.svg" class="is-sp" alt="お客様の声2">
        </li>
        <li>
          <img src="images/voice03.svg" class="is-pc" alt="お客様の声3">
          <img src="images/voice03_sp.svg" class="is-sp" alt="お客様の声3">
        </li>
        <li>
          <img src="images/voice04.svg" class="is-pc" alt="お客様の声4">
          <img src="images/voice04_sp.svg" class="is-sp" alt="お客様の声4">
        </li>
      </ul>
    </div>
  </section>
"""

qa_section = """
  <section id="qa_content" class="qa_content">
    <div class="inner">
      <picture class="qa-img">
        <source srcset="images/qa_content.svg" media="(min-width: 768px)"/>
        <img src="images/qa_content.svg" alt="よくある質問">
      </picture>
      <h2 class="qaTitle">皆様から頂くよくあるご質問をまとめました。<br>その他ご質問やご不明点がございましたら<br class="is-sp">何なりとお申し付けください。</h2>
      <div class="qa-content">
        <ul>
          <li>
            <div class="qa__item-question">
              <div class="qa__item-question-p"><img src="images/q.svg" alt="Q"> なぜエンジンオイルは必要なの？</div>
              <div class="qa__item--open"></div>
            </div>
            <div class="qa__item-answer">
              <p>金属表面の保護、金属同士の摩擦を軽減するためです。</p>
            </div>
          </li>
          <li>
            <div class="qa__item-question">
              <div class="qa__item-question-p"><img src="images/q.svg" alt="Q"> エンジンオイルにはどのような働きがあるの？</div>
              <div class="qa__item--open"></div>
            </div>
            <div class="qa__item-answer">
              <p>潤滑作用・冷却作用・密封作用・防錆作用・清浄作用があります。</p>
            </div>
          </li>
          <li>
            <div class="qa__item-question">
              <div class="qa__item-question-p"><img src="images/q.svg" alt="Q"> エンジンオイルはいつ交換したら良いの？</div>
              <div class="qa__item--open"></div>
            </div>
            <div class="qa__item-answer">
              <p>一般的には6ヶ月または5,000km毎が望ましいです。シビアコンディションではより短いサイクルを推奨します。</p>
            </div>
          </li>
          <li>
            <div class="qa__item-question">
              <div class="qa__item-question-p"><img src="images/q.svg" alt="Q"> エンジンオイルって減るの？</div>
              <div class="qa__item--open"></div>
            </div>
            <div class="qa__item-answer">
              <p>走行状況等により徐々に減少します。量が減りすぎるとトラブルの原因になるため定期的な点検が必要です。</p>
            </div>
          </li>
          <li>
            <div class="qa__item-question">
              <div class="qa__item-question-p"><img src="images/q.svg" alt="Q"> 粘度グレードってなに？</div>
              <div class="qa__item--open"></div>
            </div>
            <div class="qa__item-answer">
              <p>オイルの硬さをSAE粘度分類で表します。低温側に「W」を付けて区別します。</p>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </section>
  <!-- 実施店舗詳細（大船渡店に変更） -->
  <section id="shop" class="shop">
    <h2 class="shop-title">実施店舗詳細</h2>
    <div class="inner">
      <div class="access-area">
        <h3 class="access-area__title">■ 車検のコバック 大船渡店</h3>
        <ul class="access-area__list">
          <li class="access-area__item">住所 / 岩手県大船渡市猪川町久名畑4-30</li>
          <li class="access-area__item">営業時間 / 9:00〜18:00</li>
          <li class="access-area__item">電話番号 / <a href="tel:0120-589-196">0120-589-196</a></li>
          <li class="access-area__item">定休日 / 火曜、水曜、GW、夏季休暇、年末年始</li>
        </ul>
      </div>
      <div class="map" style="text-align:center;">
        <a class="map-btn" href="https://maps.app.goo.gl/uu4b8K8NXsCAYwnf8" target="_blank" rel="noopener">🗺 Googleマップを開く</a>
      </div>
    </div>
  </section>

  <footer id="footer" class="footer">
    <div class="logo"><img src="images/footer-logo.svg" alt="フッターロゴ"></div>
    <div class="copy">当サイト内に掲載されている全ての画像・文章の転載、転用を禁止します。© KOBAC Co.,Ltd. All rights reserved.</div>
    <div class="pagetop"><a href="#mv"><img src="images/pagetop.svg" alt=""></a></div>
  </footer>

  <!-- スマホ下部固定TELボタン -->
  <a href="tel:0120-589-196" class="sticky-tel">📞 今すぐ電話</a>
